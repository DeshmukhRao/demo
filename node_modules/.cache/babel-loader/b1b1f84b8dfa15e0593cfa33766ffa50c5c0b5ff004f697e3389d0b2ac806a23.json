{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.API_NODE_HANDLER = exports.isEqual = exports.isCidReg = void 0;\nconst config_1 = __importDefault(require(\"../config\"));\nconst isCidReg = cid => /Qm[1-9A-HJ-NP-Za-km-z]{44}|b[A-Za-z2-7]{58}|B[A-Z2-7]{58}|z[1-9A-HJ-NP-Za-km-z]{48}|F[0-9A-F]{50}/.test(cid);\nexports.isCidReg = isCidReg;\nconst isEqual = (...objects) => objects.every(obj => JSON.stringify(obj) === JSON.stringify(objects[0]));\nexports.isEqual = isEqual;\nasync function API_NODE_HANDLER(endpoint, verb, auth_token = \"\", body = null, retryCount = 3) {\n  const url = new URL(`${config_1.default.isDev ? config_1.default.lighthouseBLSNodeDev : config_1.default.lighthouseAuthNode}${endpoint}`);\n  const init = {\n    method: verb,\n    headers: {\n      \"Content-type\": \"application/json\",\n      Authorization: auth_token ? `Bearer ${auth_token}` : \"\"\n    }\n  };\n  if ((verb === \"POST\" || verb === \"PUT\" || verb === \"DELETE\") && body) {\n    init.body = JSON.stringify(body);\n  }\n  for (let i = 0; i < retryCount; i++) {\n    try {\n      const response = await fetch(url.toString(), init);\n      if (!response.ok) {\n        if (response.status == 404) {\n          throw new Error(JSON.stringify({\n            message: \"fetch Error\",\n            statusCode: response.status\n          }));\n        }\n        const errorBody = await response.json();\n        throw new Error(JSON.stringify({\n          ...errorBody,\n          statusCode: response.status\n        }));\n      }\n      return response.json();\n    } catch (error) {\n      if (!error?.message?.includes(\"fetch\")) {\n        throw error;\n      }\n      if (i === retryCount - 1) throw error; // Throw error on the last attempt\n      await new Promise(resolve => setTimeout(resolve, 1000)); // Wait for 1 second\n    }\n  }\n}\nexports.API_NODE_HANDLER = API_NODE_HANDLER;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","API_NODE_HANDLER","isEqual","isCidReg","config_1","require","cid","test","objects","every","obj","JSON","stringify","endpoint","verb","auth_token","body","retryCount","url","URL","default","isDev","lighthouseBLSNodeDev","lighthouseAuthNode","init","method","headers","Authorization","i","response","fetch","toString","ok","status","Error","message","statusCode","errorBody","json","error","includes","Promise","resolve","setTimeout"],"sources":["D:/demo/node_modules/@lighthouse-web3/kavach/dist/util/index.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.API_NODE_HANDLER = exports.isEqual = exports.isCidReg = void 0;\nconst config_1 = __importDefault(require(\"../config\"));\nconst isCidReg = (cid) => /Qm[1-9A-HJ-NP-Za-km-z]{44}|b[A-Za-z2-7]{58}|B[A-Z2-7]{58}|z[1-9A-HJ-NP-Za-km-z]{48}|F[0-9A-F]{50}/.test(cid);\nexports.isCidReg = isCidReg;\nconst isEqual = (...objects) => objects.every((obj) => JSON.stringify(obj) === JSON.stringify(objects[0]));\nexports.isEqual = isEqual;\nasync function API_NODE_HANDLER(endpoint, verb, auth_token = \"\", body = null, retryCount = 3) {\n    const url = new URL(`${config_1.default.isDev ? config_1.default.lighthouseBLSNodeDev : config_1.default.lighthouseAuthNode}${endpoint}`);\n    const init = {\n        method: verb,\n        headers: {\n            \"Content-type\": \"application/json\",\n            Authorization: auth_token ? `Bearer ${auth_token}` : \"\",\n        },\n    };\n    if ((verb === \"POST\" || verb === \"PUT\" || verb === \"DELETE\") && body) {\n        init.body = JSON.stringify(body);\n    }\n    for (let i = 0; i < retryCount; i++) {\n        try {\n            const response = await fetch(url.toString(), init);\n            if (!response.ok) {\n                if (response.status == 404) {\n                    throw new Error(JSON.stringify({\n                        message: \"fetch Error\",\n                        statusCode: response.status,\n                    }));\n                }\n                const errorBody = await response.json();\n                throw new Error(JSON.stringify({ ...errorBody, statusCode: response.status }));\n            }\n            return response.json();\n        }\n        catch (error) {\n            if (!error?.message?.includes(\"fetch\")) {\n                throw error;\n            }\n            if (i === retryCount - 1)\n                throw error; // Throw error on the last attempt\n            await new Promise((resolve) => setTimeout(resolve, 1000)); // Wait for 1 second\n        }\n    }\n}\nexports.API_NODE_HANDLER = API_NODE_HANDLER;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}